"""
R1-RAG Prompt模板

包含精心设计的prompt用于:
1. 训练prompt模板（引导模型输出格式）
2. GPT-4o标注生成（创建黄金规划）
"""

# 演示预期输出格式的one-shot示例
ONE_SHOT_EXAMPLE = """## 示例:
输入:
谁执导了《泰坦尼克号》的导演的第一部电影？

输出:
<think> 这个问题涉及多个实体和关系，所以最好分解成更小的子问题。首先，我需要找到《泰坦尼克号》的导演。然后，我需要查找该导演的第一部电影。 </think>
<plan>
{ "Q1": ["谁执导了《泰坦尼克号》？", "#1"], "Q2": ["#1的第一部电影是什么？", "#2"] } 
</plan>

<subPlan>
    <think> 首先，我需要找出《泰坦尼克号》的导演。 </think>
    <search> 泰坦尼克号 导演 </search>
    <information> 《泰坦尼克号》是1997年上映的史诗级爱情灾难片，由詹姆斯·卡梅隆执导。 </information>
    <think> 信息显示詹姆斯·卡梅隆是导演。 </think>
    <subAnswer> #1 = 詹姆斯·卡梅隆 </subAnswer>
</subPlan>

<subPlan>
    <think> 接下来，我需要查找詹姆斯·卡梅隆的第一部电影。 </think>
    <search> 詹姆斯·卡梅隆 第一部电影 导演处女作 </search>
    <information> 詹姆斯·卡梅隆的导演处女作是1982年的《食人鱼2：繁殖》。 </information>
    <think> 证据表明他的第一部电影是《食人鱼2》。 </think>
    <subAnswer> #2 = 食人鱼2 </subAnswer>
</subPlan>

<think> 我已经从子问题中收集了所有必要的信息，现在可以提供最终答案了。 </think>
<answer> 食人鱼2 </answer>
"""

# 主训练prompt模板
PLANNING_PROMPT_TEMPLATE = """按照以下步骤回答给定的问题。在生成<plan>、<search>、<subAnswer>和<answer>之前，你必须在<think>和</think>之间进行所有推理。

步骤1: 在<plan>和</plan>块中明确生成一个或多个子问题。
 - 每个子问题必须包含一个问题和一个代表该问题答案的占位符（#1, #2等）。
 - 每个子问题应该尽可能简短精确。
 - 如果一个子问题依赖于前一个子问题的答案，使用占位符（#1, #2等）来表示该依赖。
 - 子问题的输出格式必须遵循以下JSON结构:
{{
    "Q1": ["第一个子问题", "#1"],
    "Q2": ["使用#1的第二个子问题", "#2"],
    ...
}}

步骤2: 对于每个子问题，创建一个包含在<subPlan>和</subPlan>中的块。
在每个<subPlan>块中你必须:
 - 按顺序从<plan>中取出一个子问题，填入<search>和</search>之间。
 - 如果你缺少某些知识，使用<search>查询</search>调用搜索引擎。搜索引擎将返回包含在<information>和</information>中的结果。你可以根据需要搜索多次。
 - 用<subAnswer>结束该块，将答案绑定到当前子问题。

步骤3: 在<answer>和</answer>中提供最终结果，不需要详细解释。

{one_shot_example}

## 现在轮到你了！请回答以下问题！！！
问题: {question}
"""

# GPT-4o生成黄金规划标注的prompt
GPT4O_PLAN_ANNOTATION_PROMPT = """你是一个专家，擅长将复杂的多跳问题分解为结构化的推理规划。

给定一个多跳问题及其黄金答案，生成:
1. 将问题分解为顺序子问题的规划（DAG）
2. 每个子问题的中间答案

重要规则:
- 每个子问题应该检索一条信息
- 使用占位符（#1, #2等）来引用前面的答案
- 最后一个子问题的答案应该与黄金答案匹配
- 确保依赖结构正确（后面的问题依赖于前面的问题）

输出格式（JSON）:
{{
    "plan": {{
        "Q1": ["<子问题1>", "#1"],
        "Q2": ["<使用#1的子问题2>", "#2"],
        ...
    }},
    "graph": {{
        "Q1": {{"answer": "<中间答案1>"}},
        "Q2": {{"answer": "<中间答案2>"}},
        ...
    }}
}}

问题: {question}
黄金答案: {gold_answer}

生成规划和执行图:
"""

# 验证生成规划的prompt
PLAN_VALIDATION_PROMPT = """给定以下问题、规划和黄金答案，验证规划是否正确导向答案。

问题: {question}
黄金答案: {gold_answer}

生成的规划:
{plan}

执行图:
{graph}

这个规划是否有效？（回答 是 或 否，并简要解释）
"""
